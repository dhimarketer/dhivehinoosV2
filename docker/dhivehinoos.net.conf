# Apache configuration for dhivehinoos.net
# REMOVE THE ENTIRE <VirtualHost *:80> BLOCK
# KEEP ONLY THE HTTPS BLOCK:

<VirtualHost *:443>
    ServerName dhivehinoos.net
    ServerAlias www.dhivehinoos.net
    
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Backend API routes
    ProxyPass /api/ http://127.0.0.1:8052/api/
    ProxyPassReverse /api/ http://127.0.0.1:8052/api/
    
    # Django Admin
    ProxyPass /admin/ http://127.0.0.1:8052/admin/
    ProxyPassReverse /admin/ http://127.0.0.1:8052/admin/
    
    # Media files (served directly from backend)
    ProxyPass /media/ http://127.0.0.1:8052/media/
    ProxyPassReverse /media/ http://127.0.0.1:8052/media/
    
    # Static files (served directly from backend)
    ProxyPass /static/ http://127.0.0.1:8052/static/
    ProxyPassReverse /static/ http://127.0.0.1:8052/static/
    
    # Frontend (catch-all for React app)
    ProxyPass / http://127.0.0.1:8053/
    ProxyPassReverse / http://127.0.0.1:8053/
    
    # Serve media files directly from filesystem (optional optimization)
    <Directory /opt/dhivehinoos/media>
        Require all granted
    </Directory>
    Alias /media /opt/dhivehinoos/media
    
    # Serve static files directly from filesystem (optional optimization)
    <Directory /opt/dhivehinoos/static>
        Require all granted
    </Directory>
    Alias /static /opt/dhivehinoos/static
    
    # SSL Configuration
    SSLEngine on
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/dhivehinoos.net/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/dhivehinoos.net/privkey.pem
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/dhivehinoos_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/dhivehinoos_ssl_access.log combined
</VirtualHost>
