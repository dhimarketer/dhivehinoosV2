<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /usr/local/apache2/htdocs
    DirectoryIndex index.html

    # Proxy API requests to backend
    ProxyPreserveHost On
    ProxyPass /api/ http://dhivehinoos_backend:8000/api/
    ProxyPassReverse /api/ http://dhivehinoos_backend:8000/api/
    
    # Proxy admin requests to backend
    ProxyPass /admin/ http://dhivehinoos_backend:8000/admin/
    ProxyPassReverse /admin/ http://dhivehinoos_backend:8000/admin/

    # Handle React Router - redirect all requests to index.html
    <Directory "/usr/local/apache2/htdocs">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable mod_rewrite for React Router
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Cache static assets
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </LocationMatch>

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>
